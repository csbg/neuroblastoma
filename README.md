# Analysis of scRNA-seq data from bone marrow samples of ultra-high-risk neuroblastoma patients

## Folders

(Not all of these folders appear in the git repository.)

- `data_generated`: output files generated by the scripts in this repository.
- `data_raw`: various raw input data
- `doc`: project documentation
- `literature`: relevant publications
- `metadata`: additional required data
- `plots`: generated plots
- `renv`: R environment data
- `tables`: exported tables



## Download data

Create a folder `data_raw` that will contain raw data in the following subfolders:

- `adrmed`:
  - `adrenal_medulla_Seurat.RDS`: reference expression data for adrenal medullary cells; download from https://adrenal.kitz-heidelberg.de/developmental_programs_NB_viz/ (Download data -> Download Adrenal medulla data -> Seurat object (RDS))
- `COUNT`: TBD
- `GSE137804`: download the following files from GEO series GSE137804:
  - `GSE137804_tumor_dataset_annotation.csv.gz`
  - eleven files extracted from `GSE137804_RAW.tar`:
    `GSM4088774_T10_gene_cell_exprs_table.xls.gz`
    `GSM4088776_T27_gene_cell_exprs_table.xls.gz`
    `GSM4088777_T34_gene_cell_exprs_table.xls.gz`
    `GSM4088780_T69_gene_cell_exprs_table.xls.gz`
    `GSM4088781_T71_gene_cell_exprs_table.xls.gz`
    `GSM4088782_T75_gene_cell_exprs_table.xls.gz`
    `GSM4088783_T92_gene_cell_exprs_table.xls.gz`
    `GSM4654669_T162_gene_cell_exprs_table.xls.gz`
    `GSM4654672_T200_gene_cell_exprs_table.xls.gz`
    `GSM4654673_T214_gene_cell_exprs_table.xls.gz`
    `GSM4654674_T230_gene_cell_exprs_table.xls.gz`
- `snp_array`: Extract the contents of `snp_array.tgz` provided in Zenodo repository XXX

Optionally, obtain intermediary data: Extract the contents of `data_generated.tgz` from Zenodo repository XXX to folder `data_generated`.



## Main workflow

Run these R scripts in the given order to generate all files
required by figures and tables.

- [perform_qc.R](perform_qc.R) -
  perform QC filtering, ensure unique cell names
- [integrate_rna.R](integrate_rna.R) -
  integrate scRNA-seq samples with monocle, perform basic analyses
  and extract resulting metadata
- [correct_ambiance.R](correct_ambiance.R) –
  remove cell-free RNA contamination
- [classify_cell_types.R](classify_cell_types.R) -
  perform cell type classification via SingleR
- [assemble_metadata.R](assemble_metadata.R) -
  generate one CSV and RDS file with all metadata
- [analyse_dge.R](analyse_dge.R) -
  analyse differential gene expression using mixed models
- [analyse_cnv.R](analyse_cnv.R) -
  analyse copy number variations
- [analyse_ccc.R](analyse_ccc.R) -
  analyse cell-cell communication
- [analyse_myeloid.R](analyse_myeloid.R) -
  analyse myeloid subpopulation
- [prepare_data_dong.R](prepare_data_dong.R) –
  prepare dataset by Dong et al for analysis
- [classify_as_adrenal.R](classify_as_adrenal.R) –
  classify tumor cells as adrenal medullary cell types
- [compare_tumors_pseudobulk.R](compare_tumors_pseudobulk.R) –
  comparison of tumor samples via pseudobulk correlation

  
  
## Plotting functions

Run these R scripts in arbitrary order to generate exploratory figures:

- [plot_compare_tumors_adrmed.R](plot_compare_tumors_adrmed.R) –
  comparison of tumor cells to adrenal medullary cell types
- [plot_dge.R](plot_dge.R) -
  results from mixed model DE analysis
- [plot_markers.R](plot_markers.R) -
  canonical cell type markers
- [plot_misc.R](plot_misc.R) -
  miscellaneous plots
  

Run these R scripts in arbitrary order to generate publication figures and tables:

- [plot_figure_1_S1.R](plot_figure_1_S1.R) - includes Tables S2 and S3
- [plot_figure_2_S2.R](plot_figure_2_S2.R)
- [plot_figure_3_S3.R](plot_figure_3_S3.R) - includes Table S6
- [plot_figure_4_S4_S7b.R](plot_figure_4_S4_S7b.R) - includes Tables S4 and S5
- [plot_figure_S5_S7c.R](plot_figure_S5_S7c.R) - includes Table S7 and S8



## Other scripts

- [common_functions.R](common_functions.R) -
  functions used throughout the project
- [plot_dependencies.R](plot_dependencies.R) –
  plot the dependency graph
- [styling.R](styling.R) –
  functions for generating publication-quality figures and tables
